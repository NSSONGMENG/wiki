
汇编入门

```code
 基于清华大学出版社王爽著《汇编语言》第三版
```

CPU是计算机的核心部件，它控制着整个计算机的运作并进行运算。计算机有连接CPU和其他芯片的导线，成为总线。总线从物理上来讲是一根根导线的集合。根据传递信息的不同，总线从逻辑上分为地址总线，数据总线和控制总线三类。

***地址总线***
CPU通过地址总线来指定存储单元，地址总线的宽度（数量）决定了CPU的寻址能力。例如一个32跟地址总线的CPU，其寻址能力是2^32（4GB）个存储单元。

***数据总线***
CPU和内存或其他元器件之间的数据传送是通过数据总线进行的，数据总线的宽度决定了数据传送的速度，例如8根数据总线一次性可以传送8位二进制数据（一个字节）。

***控制总线***
CPU对外部器件的控制是通过控制总线进行的，控制总线的宽度决定了CPU对外部器件的控制能力。

## 寄存器
以8086CPU为例，8086CPU的所有寄存器都是16位的，可以存放两个字节。

### 通用寄存器：AX，BX，CX，DX

通常用来存放一般性的数据，其中每个寄存器可以分为两个独立的8位寄存器使用，即高8位和低8位，如：
- AX可以分为AH和AL
- BX可以分为BH和BL

8086CPU有20位地址总线，而寄存器是16位，内部一次性处理、传输、暂存的地址为16位。因此8086CPU的地址加法器采用***物理地址 = 段地址 x 16 + 偏移地址*** 的方法用两个16位地址合成一个20位的物理地址。

***几条汇编指令***

指令 | 操作 |
---- | ---- |
mov ax, 18 | 将18送入寄存器AX |
mov ah, 78 | 将78送入寄存器AH |
mov bx, ax | 将AX中的数据送入BX中 |
add ax, 8  | 将AX中的数值加上8 |
add bx, ax | 将BX与AX中的数据相加，存入BX中 |
sub bx, ax | 用BX中的数据减去AX中的数据，存入BX中 |

### 段地址寄存器：CS，DS，SS，ES

#### CS:IP
CS（Code Segment）为代码指针段地址寄存器，IP为指令指针偏移地址寄存器。他们是8086CPU中两个关键的寄存器，指示了CPU当前要读取命令的地址。即任意时刻，CPU都会将CS:IP指向的内容当做指令执行。

8086工作过程:
1. 从CS:IP执行的内存单元读取指令进入指令缓冲器
2. IP指向下一条指令
3. 执行指令，转到步骤1

可通过***jmp***指令修改CS:IP寄存器中的内容

> jmp 段地址 : 偏移地址    
> 用指令中的段地址修改CS，用便宜地址修改IP
>
> jmp 寄存器
> 使用寄存器的值修改IP

---

#### DS和[address]
DS(Data Segment)为要访问物理地址的段地址寄存器，用来存放将要被访问内存单元的段地址。

**[address]** 表示由段地址寄存器DS中保存的段地址和偏移地址address共同指示的一个内存单元。其中address表示偏移地址，当前段地址保存在寄存器DS中，如[1]表示偏移地址为1。

---

#### SS:SP
栈：一种具有先进后出（LIFO last in first out）访问方式的存储空间。8086CPU出入栈操作都是以字（16位）为单位进行的，与寄存器的位数一致。

SS（Stack Segment）为栈顶指针段地址寄存器，SP为栈顶指针的偏移地址寄存器，它们组合指定了当前栈顶元素的物理地址。
入栈时，指针向低地址移动，出栈时，指针向高地址移动。

***栈操作命令***

指令 | 操作 |
---- | ---- |
push ax | 将AX中的数据送入栈中 |
pop ax | 将栈顶的数据送入AX |

push操作先将SP指针-2使得SS:SP指向新的栈顶地址单元，然后将数据送入该栈顶地址单元。
pop操作先根据SS:SP读取数据，然后SP指针+2。

注：push和pop指令修改的只是SP，即栈顶的变化范围是0000H~FFFFH，即最大共2^16（64KB）的空间。

#### ES
Extra Segment，扩展用
